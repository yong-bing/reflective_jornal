{% extends 'blog/components/base.html' %}
{% load static %}

{% block nav %}
    {% include 'blog/components/nav.html' %}
{% endblock %}


{% block main %}
    <div class="container py-5 mt-5-custom">
        <h1 class="text-center mb-5">探索技术前沿</h1>

        <!-- 文章筛选器 -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <select class="form-select" aria-label="选择分类" id="category-select">
                    <option selected value="all">全部分类</option>
                    {% for category in categories %}
                        <option value="{{ category.nid }}">{{ category.content }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="搜索文章..." aria-label="搜索文章">
                    <button class="btn btn-primary" type="button"><i class="bi bi-search"></i></button>
                </div>
            </div>
        </div>

        <div class="row" id="article-list">
            {% for article in articles %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card article-card clickable-card"
                         data-url="{% url 'article_detail' article.user.username article.nid %}">
                        <div class="card-img-wrapper">
                            <img src="{{ MEDIA_URL }}{{ article.cover }}" class="card-img-top" alt="文章图片">
                        </div>
                        <div class="card-body">
                            <div class="card-meta">
                                <span><i class="bi bi-person"></i> {{ article.user.username }}</span>
                                <span><i
                                        class="far fa-calendar-alt me-1"></i>{{ article.created_time |date:"Y年m月d日" }}</span>
                                <span><i class="far fa-clock me-1"></i> 5分钟阅读</span>
                                <span><i class="far fa-eye me-1"></i> {{ article.views }} 阅读</span>
                            </div>
                            <h5 class="card-title">{{ article.title }}</h5>
                            <p class="card-text">{{ article.desc }}</p>
                        </div>
                        <div class="card-footer">
                            <div class="tag-container">
                                <span class="tag">人工智能</span>
                                <span class="tag">软件开发</span>
                            </div>
                            <a href="{% url 'article_detail' article.user.username article.nid %}"
                               class="btn btn-custom btn-sm">阅读全文</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- 分页 -->
        <nav aria-label="Page navigation" class="mt-5">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">上一页</a>
                </li>
                <li class="page-item active" aria-current="page">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">下一页</a>
                </li>
            </ul>
        </nav>
    </div>
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            function loadItems(category = 'all', page = 1) {
                $.ajax({
                    url: '/get-items/',
                    data: {
                        'category': category,
                        'page': page
                    },
                    dataType: 'json',
                    success: function (data) {
                        let content = '<ul>';
                        data.items.forEach(function (item) {
                            content += `<li>${item.name}</li>`;
                        });
                        content += '</ul>';

                        $('#content-container').html(content);

                        let pagination = '';
                        if (data.has_previous) {
                            pagination += `<button class="page-btn" data-page="${data.current_page - 1}">上一页</button>`;
                        }
                        pagination += `<span>第 ${data.current_page} 页，共 ${data.num_pages} 页</span>`;
                        if (data.has_next) {
                            pagination += `<button class="page-btn" data-page="${data.current_page + 1}">下一页</button>`;
                        }
                        $('#pagination').html(pagination);
                    }
                });
            }

            // 初始加载
            loadItems();

            // 分类选择变化时
            $('#category-select').change(function () {
                loadItems($(this).val());
            });

            // 分页按钮点击事件
            $(document).on('click', '.page-btn', function () {
                let category = $('#category-select').val();
                console.log(category);
                let page = $(this).data('page');
                loadItems(category, page);
            });
        });
    </script>
{% endblock %}